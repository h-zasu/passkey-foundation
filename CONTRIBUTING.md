# Contributing Guidelines

本プロジェクトへの貢献方法について説明します。

## 品質保証とコラボレーション

### **必須：単体テスト実装**

#### テスト駆動開発（TDD）
- **Red-Green-Refactorサイクル**: テスト失敗 → 実装 → リファクタリング
- 機能実装前にテストケースを作成
- テスト実行コマンドで全テストが通ることを確認

#### 単体テスト要件
- **各新機能に対応するテストを必須実装**
- ビジネスロジックのエッジケースをカバー
- エラーハンドリングのテスト含む
- 適切なテストファイル命名規則に従う

#### テストカバレッジ
- 新規実装コードは可能な限り100%カバレッジを目指す
- プリコミットチェックでテスト実行必須
- テスト失敗時は実装を修正してから次へ進む

### **必須：ブランチ戦略とPRワークフロー**

#### ブランチ命名規則
- `feature/<task-name>` - 新機能開発
- `fix/<bug-name>` - バグ修正
- `refactor/<component-name>` - リファクタリング
- `test/<feature-name>` - テスト追加

#### プルリクエスト（PR）ワークフロー
1. **機能ごとにブランチを作成**
   ```bash
   git checkout -b feature/user-authentication
   ```

2. **開発・テスト実装**
   - 機能実装と単体テスト作成
   - プリコミットチェックで品質確認

3. **PR作成と説明**
   - 変更内容の明確な説明
   - テストケースの説明
   - 影響範囲の明記

4. **コードレビュー必須項目**
   - [ ] 単体テストが実装されている
   - [ ] 全テストが通過している
   - [ ] Linterの警告がない
   - [ ] コードフォーマットが正しい
   - [ ] セキュリティリスクがない
   - [ ] パフォーマンスへの影響が考慮されている
   - [ ] エラーハンドリングが適切

5. **マージ前の品質ゲート**
   - プリコミットチェック全通過
   - レビュアーによる承認
   - CI/CDパイプライン成功
   - ドキュメント更新（必要に応じて）

#### PRテンプレート推奨項目
```markdown
## 変更概要
- 何を変更したか

## テスト
- 実装したテストケース
- テストカバレッジ

## 確認事項
- [ ] 単体テスト実装済み
- [ ] プリコミットチェック通過
- [ ] ドキュメント更新（必要に応じて）
```

#### マージ後の確認
- マージ後のCI/CD成功確認
- 関連ドキュメントの更新

## プロジェクト固有の品質チェック

### コード品質管理
#### **必須：コミット前のプリコミットチェック**
- **全てのコミット前に必ず`cargo xtask precommit`を実行**
- 全てのエラーと警告を修正してからコミットすること
- 以下のチェックが全て成功する必要あり：
  - `cargo fmt --check` - コードフォーマット
  - `cargo check` - コンパイルチェック
  - `cargo clippy` - Lintチェック（警告をエラー扱い）
  - `cargo test` - 全テスト実行

#### Clippy警告の自動修正
- `cargo clippy --fix --allow-dirty` - 自動修正可能な警告を修正
- clippyが検出する一般的な問題：
  - `uninlined_format_args` - format!内の変数直接使用
  - `unwrap_or_default` - unwrap_or_else(Default::default)の簡略化
  - `map_clone` - .map(|x| x.clone())を.cloned()に
  - `derivable_impls` - 導出可能なDefaultトレイト実装
- 自動修正後は必ず`cargo fmt`でフォーマット調整

#### スキップオプション（緊急時のみ）
- `--skip-fmt` - フォーマットチェックをスキップ
- `--skip-clippy` - clippyチェックをスキップ
- `--skip-test` - テスト実行をスキップ

### 依存関係の管理
#### **必須：パッチバージョンまでの明示**
- **Rustベストプラクティス**: 全ての依存関係でパッチバージョン（major.minor.patch）まで明示
- ❌ 悪い例: `serde = "1.0"`, `tokio = "1"`
- ✅ 良い例: `serde = "1.0.219"`, `tokio = "1.46.1"`
- **理由**: 再現可能なビルドの保証、予期しない破壊的変更の回避

#### cargo-editツールの使用
- `cargo install cargo-edit` - cargo upgradeコマンドを利用可能に
- `cargo upgrade` - 互換性のある依存関係を最新バージョンに自動更新
- `cargo upgrade --incompatible --dry-run` - 非互換バージョンアップの確認
- `cargo search <crate-name>` - 個別クレートの最新バージョン確認

#### 更新手順とベストプラクティス
1. `cargo upgrade` - パッチバージョンまで自動更新
2. 必要に応じて手動でパッチバージョンを明示的に記載
3. `cargo check` - コンパイルエラーがないことを確認
4. `cargo xtask precommit` - 全チェックが通ることを確認
5. 問題があれば元のバージョンに戻すか、コードを修正